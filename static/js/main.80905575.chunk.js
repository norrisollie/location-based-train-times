(this["webpackJsonplocation-based-train-times"]=this["webpackJsonplocation-based-train-times"]||[]).push([[0],{17:function(t,e,n){},18:function(t,e,n){},19:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n(1),c=n.n(o),i=n(11),s=n.n(i),r=(n(17),n(6)),u=n(8),l=n(2),d=n(3),p=n(5),g=n(4),b=function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return void 0===this.props.postcode||this.props.postcode.length<=0?null:Object(a.jsxs)("div",{className:"postcode-wrapper",children:["Your postcode is ",this.props.postcode]})}}]),n}(o.Component),h=n(9),j=function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=e.call.apply(e,[this].concat(o))).componentDidUpdate=function(e){e.animateSearchWrapper!==t.props.animateSearchWrapper&&h.b.to(t.searchWrapper,{height:"auto",width:"auto"})},t}return Object(d.a)(n,[{key:"render",value:function(){var t=this;return Object(a.jsxs)("div",{className:"search-wrapper",ref:function(e){t.searchWrapper=e},children:[Object(a.jsxs)("form",{onSubmit:function(t){t.preventDefault()},children:[Object(a.jsx)("input",{type:"text",name:"searchQuery",placeholder:"Enter a postcode or town",onChange:function(e){t.props.searchQueryHandler(e)}}),Object(a.jsx)("button",{style:this.props.locationSearching?{backgroundImage:"url(data:image/svg+xml;base64,PCEtLSBCeSBTYW0gSGVyYmVydCAoQHNoZXJiKSwgZm9yIGV2ZXJ5b25lLiBNb3JlIEAgaHR0cDovL2dvby5nbC83QUp6YkwgLS0+Cjxzdmcgd2lkdGg9IjM4IiBoZWlnaHQ9IjM4IiB2aWV3Qm94PSIwIDAgMzggMzgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIj4KICAgIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMSAxKSIgc3Ryb2tlLXdpZHRoPSIyIj4KICAgICAgICAgICAgPGNpcmNsZSBzdHJva2Utb3BhY2l0eT0iLjUiIGN4PSIxOCIgY3k9IjE4IiByPSIxOCIvPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYgMThjMC05Ljk0LTguMDYtMTgtMTgtMTgiPgogICAgICAgICAgICAgICAgPGFuaW1hdGVUcmFuc2Zvcm0KICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iCiAgICAgICAgICAgICAgICAgICAgdHlwZT0icm90YXRlIgogICAgICAgICAgICAgICAgICAgIGZyb209IjAgMTggMTgiCiAgICAgICAgICAgICAgICAgICAgdG89IjM2MCAxOCAxOCIKICAgICAgICAgICAgICAgICAgICBkdXI9IjFzIgogICAgICAgICAgICAgICAgICAgIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+CiAgICAgICAgICAgIDwvcGF0aD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==)"}:{},type:"button",onClick:function(e){t.props.geolocationClickHandler(e)}}),Object(a.jsx)("button",{type:"submit",onClick:function(e){t.props.buttonClickHandler(e)}})]}),Object(a.jsx)(b,{postcode:this.props.userPostcode})]})}}]),n}(o.Component),C=n(7),I=n.n(C),m=function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=e.call.apply(e,[this].concat(o))).map=null,t.marker=null,t.initMap=function(){I.a.accessToken="pk.eyJ1Ijoibm9ycmlzb2xsaWUiLCJhIjoiY2ozbG1wdjQ4MDA2cTJxcDllbTl2aGRhbyJ9.sQsQfFSu0NcRseoxKW0_7w",t.map=new I.a.Map({container:t.mapContainer,style:"mapbox://styles/norrisollie/ckkz4s27r33g217p7pahsfati",zoom:11});var e=new I.a.LngLat(t.props.longitude,t.props.latitude);t.map.setCenter(e),h.a.to(t.mapContainer,{autoAlpha:1,pointerEvents:"all"})},t.componentDidMount=function(){t.initMap(),t.initMarkers()},t}return Object(d.a)(n,[{key:"initMarkers",value:function(){var t=this,e=[];this.props.stations.forEach((function(n){var a;a=[n.longitude,n.latitude],e.push(a),t.marker=new I.a.Marker({color:"#FFFFFF"}).setLngLat([n.longitude,n.latitude]).addTo(t.map)}));var n=e.reduce((function(t,e){return t.extend(e)}),new I.a.LngLatBounds(e[0],e[0]));this.map.fitBounds(n,{padding:100})}},{key:"render",value:function(){var t=this;return Object(a.jsx)("div",{className:"map-container",ref:function(e){t.mapContainer=e}})}}]),n}(o.Component),f=(n(18),function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(a.jsx)("div",{children:Object(a.jsxs)("div",{children:[this.props.expected_departure_time," to ",this.props.destination_name]})})}}]),n}(o.Component)),v=function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){var t;return Object(l.a)(this,n),(t=e.call(this)).getKm=function(t){return(t/1e3).toFixed(2)},t.getServices=function(e){fetch("https://transportapi.com/v3/uk/train/station/".concat(e,"///live.json?app_id=c15b5dbb&app_key=1cfe30d14a3934983892bed20b27e431&train_status=passenger")).then((function(t){return t.json()})).then((function(e){console.log(e),t.setState((function(t){return Object(r.a)(Object(r.a)({},t),{},{serviceList:e.departures.all})}),(function(){console.log(t.state)}))}))},t.componentDidMount=function(){t.getServices(t.props.station_code)},t.state={serviceList:[]},t}return Object(d.a)(n,[{key:"render",value:function(){var t;return t=this.state.serviceList.map((function(t){return Object(a.jsx)(f,Object(r.a)({},t),t.train_uid)})),Object(a.jsx)("div",{children:Object(a.jsxs)("div",{className:"station-item",children:[Object(a.jsx)("div",{className:"station-name",children:this.props.name}),Object(a.jsxs)("div",{className:"station-distance",children:[this.getKm(this.props.distance),"km"]}),Object(a.jsx)("div",{className:"service-list",children:t})]})})}}]),n}(o.Component),A=function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var t=this.props.stations.map((function(t){return Object(a.jsx)(v,Object(r.a)({},t),t.station_code)}));return Object(a.jsx)("div",{className:"stations-list",children:t})}}]),n}(o.Component),O=function(t){Object(p.a)(n,t);var e=Object(g.a)(n);function n(){var t;return Object(l.a)(this,n),(t=e.call(this)).searchWrapper=Object(o.createRef)(),t.mapContainer=Object(o.createRef)(),t.searchQueryHandler=function(e){t.setState(Object(u.a)({},e.target.name,e.target.value))},t.buttonClickHandler=function(e){e.preventDefault(),t.getClosestPostcode(t.state.searchQuery)},t.success=function(e){var n=e.coords,a=n.name,o=n.latitude,c=n.longitude;t.setState((function(t){return Object(r.a)(Object(r.a)({},t),{},{userLatitude:o,userLongitude:c,userPostcode:a,locationSearching:!1})}),(function(){var e=t.state,n=e.userLatitude,a=e.userLongitude;t.getClosestStations(n,a)}))},t.error=function(e){console.log("geolocation error:"),console.log(e),t.setState({locationSearching:!1})},t.geolocationClickHandler=function(){"geolocation"in navigator?(navigator.geolocation.getCurrentPosition(t.success,t.error,{timeout:6e5,enableHighAccuracy:!0,maximumAge:6e5}),t.setState({locationSearching:!0})):console.log("sorry, looks as though your browser doesn't support geolocation!")},t.getClosestPostcode=function(e){console.log("searching for a postcode!");var n="https://transportapi.com/v3/uk/places.json?app_id=c15b5dbb&app_key=1cfe30d14a3934983892bed20b27e431&query=".concat(e,"&type=postcode");fetch(n).then((function(t){return t.json()})).then((function(e){var n=e.member[0],a=n.name,o=n.latitude,c=n.longitude;t.setState((function(t){return Object(r.a)(Object(r.a)({},t),{},{userLatitude:o,userLongitude:c,userPostcode:a})}),(function(){var e=t.state,n=e.userLatitude,a=e.userLongitude;t.getClosestStations(n,a)}))}))},t.getClosestStations=function(e,n){var a="https://transportapi.com/v3/uk/places.json?app_id=c15b5dbb&app_key=1cfe30d14a3934983892bed20b27e431&lat=".concat(e,"&lon=").concat(n,"&type=postcode,train_station");fetch(a).then((function(t){return t.json()})).then((function(e){var n,a,o=(n=e.member,a="type",n.reduce((function(t,e){return t[e[a]]||(t[e[a]]=[]),t[e[a]].push(e),t}),{}));t.setState((function(t){return Object(r.a)(Object(r.a)({},t),{},{userPostcode:o.postcode[0].name,closestStations:o.train_station,loadMap:!t.loadMap})}))}))},t.componentDidUpdate=function(t,e){},t.state={searchQuery:null,userLatitude:null,userLongitude:null,userPostcode:null,closestStations:null,locationSearching:!1,loadMap:!1},t}return Object(d.a)(n,[{key:"render",value:function(){var t=this;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(j,{animateSearchWrapper:this.state.loadMap,searchQueryHandler:function(e){t.searchQueryHandler(e)},buttonClickHandler:function(e){t.buttonClickHandler(e)},geolocationClickHandler:function(e){t.geolocationClickHandler(e)},userPostcode:null!==this.state.userPostcode?this.state.userPostcode:"",locationSearching:this.state.locationSearching}),this.state.loadMap?Object(a.jsxs)("div",{className:"map-list-container",children:[Object(a.jsx)(m,{showMap:this.state.loadMap,latitude:this.state.userLatitude,longitude:this.state.userLongitude,stations:this.state.closestStations}),Object(a.jsx)(A,{stations:this.state.closestStations})]}):""]})}}]),n}(o.Component),y=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,20)).then((function(e){var n=e.getCLS,a=e.getFID,o=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),a(t),o(t),c(t),i(t)}))};s.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(O,{})}),document.getElementById("root")),y()}},[[19,1,2]]]);
//# sourceMappingURL=main.80905575.chunk.js.map